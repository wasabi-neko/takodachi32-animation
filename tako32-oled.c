#include "tako32-oled.h"
#include <avr/pgmspace.h>
#include "oled_driver.h"
#include "timer.h"

// 'takodachi32', 32x32px
#define TAKO_SIZE 128   // size of one frame (1 Byte for 8 pixle)
#define FRAME_N 5       // total frame
const char TAKO32[FRAME_N][TAKO_SIZE] PROGMEM = {
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x40,0x30,0x0c,0x02,0x02,0x0e,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x02,0x02,0x02,0x02,0xc2,0xf2,0xec,0x00,0x00,0x00,0xf0,0x0c,0xf2,0x0e,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x03,0x00,0xa0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xf3,0xcc,0x00,0x00,0x00,0x07,0x18,0x2f,0x30,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x60,0x00,0x02,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x81,0xc7,0xb9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x0c,0x10,0x20,0x20,0x38,0x08,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x20,0x20,0x21,0x27,0x19},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x7c,0x02,0x02,0x04,0x18,0x10,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x02,0x02,0x02,0x02,0x0a,0x7c,0x98,0x00,0x00,0x00,0x00,0xf0,0x0c,0xf2,0x0e,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x03,0x00,0xa0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x7e,0x99,0x00,0x00,0x00,0x00,0x07,0x18,0x2f,0x30,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x60,0x00,0x02,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0xfc,0x33,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x1e,0x20,0x40,0x40,0x38,0x08,0x08,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x20,0x20,0x20,0x28,0x17,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0xc2,0x02,0x02,0x04,0x18,0x10,0x10,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x02,0x02,0x01,0xc1,0xf1,0xce,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0x02,0xfa,0x06,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x03,0x00,0xa0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xe3,0x9c,0x00,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x3f,0x30,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x60,0x00,0x02,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xc7,0x39,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x23,0x20,0x20,0x10,0x0c,0x04,0x04,0x08,0x08,0x08,0x08,0x08,0x10,0x10,0x10,0x10,0x20,0x20,0x60,0x43,0x4f,0x33},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x88,0x08,0x08,0x10,0x10,0x20,0x10,0x10,0x08,0x08,0x08,0x04,0x04,0x04,0x02,0x02,0x02,0x01,0x21,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0x02,0x02,0x0c,0xf8,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x07,0xa0,0x60,0x00,0x00,0x00,0x00,0x40,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x20,0x18,0x0f,0x30,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0xe0,0x02,0x03,0x00,0x00,0x00,0x00,0x40,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x0a,0x09,0x08,0x08,0x06,0x02,0x04,0x08,0x08,0x08,0x10,0x10,0x10,0x20,0x20,0x40,0x40,0x80,0x80,0xf1},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x0c,0x04,0x04,0x08,0x10,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x02,0x02,0x02,0x01,0x01,0x0d,0x3f,0xcc,0x00,0x00,0x00,0x00,0xf0,0x0c,0x02,0x02,0x0c,0xfc,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x07,0x00,0xa0,0x60,0x00,0x00,0x00,0x00,0x00,0x0c,0x3f,0xcc,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x20,0x18,0x1f,0x60,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0xe0,0x00,0x02,0x03,0x00,0x00,0x00,0x00,0x00,0x0c,0x3f,0xcc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x10,0x10,0x10,0x0c,0x04,0x08,0x08,0x08,0x10,0x10,0x10,0x10,0x20,0x20,0x20,0x40,0x40,0x8c,0x9e,0x6d}
};

static uint32_t key_timer = 0;

void oled_render_tako(void) {
    static int frame_cnt = 0;
    // TODO: 
    // 1. clean up code
    // 2. oled rest
    // 3. add held frame by timer and cursor moveing(padding with zero)
    // 4. adjust animation frame to look better
    if (timer_elapsed32(key_timer) > SPF) {
        key_timer = timer_read32();
        frame_cnt = (frame_cnt+1) % FRAME_N;

        oled_set_cursor(7, 0);
        oled_write_raw_P(TAKO32[frame_cnt], 32);
        oled_set_cursor(7, 1);
        oled_write_raw_P(TAKO32[frame_cnt]+32, 32);
        oled_set_cursor(7, 2);
        oled_write_raw_P(TAKO32[frame_cnt]+64, 32);
        oled_set_cursor(7, 3);
        oled_write_raw_P(TAKO32[frame_cnt]+96, 32);
    }
}